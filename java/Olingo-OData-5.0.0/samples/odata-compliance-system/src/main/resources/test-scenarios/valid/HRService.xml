<?xml version="1.0" encoding="UTF-8"?>
<edmx:Edmx xmlns:edmx="http://docs.oasis-open.org/odata/ns/edmx" Version="4.0">
    <edmx:Reference Uri="https://oasis-tcs.github.io/odata-vocabularies/vocabularies/Org.OData.Core.V1.xml">
        <edmx:Include Namespace="Org.OData.Core.V1" Alias="Core"/>
    </edmx:Reference>

    <edmx:DataServices>
        <Schema xmlns="http://docs.oasis-open.org/odata/ns/edm" Namespace="HRService" Alias="HR">

            <EntityContainer Name="Container">
                <EntitySet Name="Employees" EntityType="HRService.Employee">
                    <NavigationPropertyBinding Path="Department" Target="Departments"/>
                    <NavigationPropertyBinding Path="Manager" Target="Employees"/>
                    <NavigationPropertyBinding Path="Subordinates" Target="Employees"/>
                    <NavigationPropertyBinding Path="Projects" Target="Projects"/>
                </EntitySet>

                <EntitySet Name="Departments" EntityType="HRService.Department">
                    <NavigationPropertyBinding Path="Employees" Target="Employees"/>
                    <NavigationPropertyBinding Path="Manager" Target="Employees"/>
                </EntitySet>

                <EntitySet Name="Projects" EntityType="HRService.Project">
                    <NavigationPropertyBinding Path="AssignedEmployees" Target="Employees"/>
                    <NavigationPropertyBinding Path="ProjectManager" Target="Employees"/>
                </EntitySet>

                <ActionImport Name="PromoteEmployee" Action="HRService.PromoteEmployee"/>
                <FunctionImport Name="GetEmployeesByDepartment" Function="HRService.GetEmployeesByDepartment" EntitySet="Employees"/>
            </EntityContainer>

            <EntityType Name="Employee" HasStream="false">
                <Key>
                    <PropertyRef Name="EmployeeID"/>
                </Key>
                <Property Name="EmployeeID" Type="Edm.Int32" Nullable="false"/>
                <Property Name="EmployeeNumber" Type="Edm.String" MaxLength="20" Nullable="false"/>
                <Property Name="FirstName" Type="Edm.String" MaxLength="50" Nullable="false"/>
                <Property Name="LastName" Type="Edm.String" MaxLength="50" Nullable="false"/>
                <Property Name="Email" Type="Edm.String" MaxLength="100" Nullable="false"/>
                <Property Name="HireDate" Type="Edm.Date" Nullable="false"/>
                <Property Name="Salary" Type="Edm.Decimal" Precision="18" Scale="2"/>
                <Property Name="JobTitle" Type="Edm.String" MaxLength="100"/>
                <Property Name="Status" Type="HRService.EmployeeStatus" Nullable="false"/>
                <Property Name="ContactInfo" Type="HRService.ContactInformation"/>

                <NavigationProperty Name="Department" Type="HRService.Department" Nullable="false">
                    <ReferentialConstraint Property="DepartmentID" ReferencedProperty="DepartmentID"/>
                </NavigationProperty>
                <NavigationProperty Name="Manager" Type="HRService.Employee">
                    <ReferentialConstraint Property="ManagerID" ReferencedProperty="EmployeeID"/>
                </NavigationProperty>
                <NavigationProperty Name="Subordinates" Type="Collection(HRService.Employee)"/>
                <NavigationProperty Name="Projects" Type="Collection(HRService.Project)"/>

                <Property Name="DepartmentID" Type="Edm.Int32" Nullable="false"/>
                <Property Name="ManagerID" Type="Edm.Int32"/>
            </EntityType>

            <EntityType Name="Department" HasStream="false">
                <Key>
                    <PropertyRef Name="DepartmentID"/>
                </Key>
                <Property Name="DepartmentID" Type="Edm.Int32" Nullable="false"/>
                <Property Name="Name" Type="Edm.String" MaxLength="100" Nullable="false"/>
                <Property Name="Description" Type="Edm.String" MaxLength="500"/>
                <Property Name="Budget" Type="Edm.Decimal" Precision="18" Scale="2"/>
                <Property Name="Location" Type="HRService.Address"/>

                <NavigationProperty Name="Employees" Type="Collection(HRService.Employee)"/>
                <NavigationProperty Name="Manager" Type="HRService.Employee">
                    <ReferentialConstraint Property="ManagerID" ReferencedProperty="EmployeeID"/>
                </NavigationProperty>

                <Property Name="ManagerID" Type="Edm.Int32"/>
            </EntityType>

            <EntityType Name="Project" HasStream="false">
                <Key>
                    <PropertyRef Name="ProjectID"/>
                </Key>
                <Property Name="ProjectID" Type="Edm.Int32" Nullable="false"/>
                <Property Name="Name" Type="Edm.String" MaxLength="200" Nullable="false"/>
                <Property Name="Description" Type="Edm.String" MaxLength="1000"/>
                <Property Name="StartDate" Type="Edm.Date" Nullable="false"/>
                <Property Name="EndDate" Type="Edm.Date"/>
                <Property Name="Budget" Type="Edm.Decimal" Precision="18" Scale="2"/>
                <Property Name="Status" Type="HRService.ProjectStatus" Nullable="false"/>

                <NavigationProperty Name="AssignedEmployees" Type="Collection(HRService.Employee)"/>
                <NavigationProperty Name="ProjectManager" Type="HRService.Employee" Nullable="false">
                    <ReferentialConstraint Property="ProjectManagerID" ReferencedProperty="EmployeeID"/>
                </NavigationProperty>

                <Property Name="ProjectManagerID" Type="Edm.Int32" Nullable="false"/>
            </EntityType>

            <!-- Complex Types -->
            <ComplexType Name="ContactInformation">
                <Property Name="Phone" Type="Edm.String" MaxLength="20"/>
                <Property Name="Mobile" Type="Edm.String" MaxLength="20"/>
                <Property Name="EmergencyContact" Type="HRService.EmergencyContact"/>
            </ComplexType>

            <ComplexType Name="EmergencyContact">
                <Property Name="Name" Type="Edm.String" MaxLength="100"/>
                <Property Name="Relationship" Type="Edm.String" MaxLength="50"/>
                <Property Name="Phone" Type="Edm.String" MaxLength="20"/>
            </ComplexType>

            <ComplexType Name="Address">
                <Property Name="Street" Type="Edm.String" MaxLength="200"/>
                <Property Name="City" Type="Edm.String" MaxLength="100"/>
                <Property Name="State" Type="Edm.String" MaxLength="50"/>
                <Property Name="Country" Type="Edm.String" MaxLength="50"/>
                <Property Name="PostalCode" Type="Edm.String" MaxLength="20"/>
            </ComplexType>

            <!-- Enum Types -->
            <EnumType Name="EmployeeStatus">
                <Member Name="Active" Value="0"/>
                <Member Name="Inactive" Value="1"/>
                <Member Name="OnLeave" Value="2"/>
                <Member Name="Terminated" Value="3"/>
            </EnumType>

            <EnumType Name="ProjectStatus">
                <Member Name="Planning" Value="0"/>
                <Member Name="InProgress" Value="1"/>
                <Member Name="OnHold" Value="2"/>
                <Member Name="Completed" Value="3"/>
                <Member Name="Cancelled" Value="4"/>
            </EnumType>

            <!-- Actions -->
            <Action Name="PromoteEmployee" IsBound="true">
                <Parameter Name="employee" Type="HRService.Employee"/>
                <Parameter Name="newTitle" Type="Edm.String"/>
                <Parameter Name="newSalary" Type="Edm.Decimal"/>
                <ReturnType Type="HRService.Employee"/>
            </Action>

            <!-- Functions -->
            <Function Name="GetEmployeesByDepartment" IsBound="false">
                <Parameter Name="departmentId" Type="Edm.Int32"/>
                <ReturnType Type="Collection(HRService.Employee)"/>
            </Function>

            <Function Name="CalculateAverageSalary" IsBound="true">
                <Parameter Name="department" Type="HRService.Department"/>
                <ReturnType Type="Edm.Decimal"/>
            </Function>

        </Schema>
    </edmx:DataServices>
</edmx:Edmx>

